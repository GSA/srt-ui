<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Solicitation Review Tool</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <link rel="stylesheet" type="text/css" href="/node_modules/primeng/resources/themes/omega/theme.css" />
  <link rel="stylesheet" type="text/css" href="/node_modules/primeng/resources/primeng.min.css" />
</head>
<body>
  <app-root>Loading...</app-root>

  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://use.fontawesome.com/22ad9bb71f.js"></script>
  <script src="/node_modules/chart.js/src/chart.js"></script>
  <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.bundle.min.js"></script>-->
  <script src="/node_modules/uswds/dist/js/uswds.min.js"></script>


  <script language="JavaScript">
    async function casCheck() {
      const ticketParam = window.location.search.substr(1)
        .split('&')
        .map(x => x.split('='))
        .filter(x => x[0] === 'ticket')

      if (ticketParam.length > 0) {
        const url = 'http://localhost:3000/api/casLogin?ticket=' + ticketParam[0][1]
        console.log("url", url);
        return fetch(url)
          .then( res => res.json())
          .then( data => {

            localStorage.setItem('agency', data.agency)
            localStorage.setItem('email', data.email)
            localStorage.setItem('firstName', data.firstName)
            localStorage.setItem('id', data.id)
            localStorage.setItem('lastName', data.lastName)
            localStorage.setItem('position', data.position)
            localStorage.setItem('token', data.token)
            localStorage.setItem('userRole', data.userRole)

            console.log("JSON***", data)
            window.location = '/'

            document.getElementsByTagName('app-auth')[0].innerHTML =
              '              <div class="solic-nosolic">                               ' +
              '              <div class="solic-nosolic-posi">                          ' +
              '              <ul class="cb-slideshow">                                 ' +
              '              <i class="fa fa-cog fa-spin" style="color: #4a4a4a"></i>  ' +
              '              <span>L</span></li>                                       ' +
              '            <li><span>O</span></li>                                     ' +
              '            <li><span>A</span></li>                                     ' +
              '            <li><span>D</span></li>                                     ' +
              '            <li><span>I</span></li>                                     ' +
              '            <li><span>N</span></li>                                     ' +
              '            <li><span>G</span></li>                                     ' +
              '            <li><span>.</span></li>                                     ' +
              '            <li><span>.</span></li>                                     ' +
              '            <li><span>.</span></li>                                     ' +
              '            </ul>                                                       ' +
              '            </div>                                                      ' +
              '            </div>                                                      '





            return true
          })
      }
      return false;
    }

    casCheck()
      .then( JWT => console.log("JWT", JWT))
      .catch( error => console.log("error",error))



  </script>



</body>
</html>
